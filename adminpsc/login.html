<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ADMIN-PSC — Iniciar sesión</title>
  <link rel="stylesheet" href="portal.css" />
  <script src="config.js"></script>
  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root { --card-bg:#fff; --shadow:0 10px 30px rgba(0,0,0,.06); }
    body { background: #F2F2F7; }
    .auth-wrap { max-width: 420px; margin: 120px auto; padding: 0 16px; }
    .card { background: var(--card-bg); border: 1px solid #e5e5ea; border-radius: 20px; box-shadow: var(--shadow); padding: 24px; }
    .title { font-size: 22px; font-weight: 700; margin: 0 0 12px; text-align:center; }
    .subtitle { font-size: 14px; color: #6e6e73; text-align:center; margin-bottom: 18px; }
    label { display:block; font-size: 13px; margin: 12px 0 6px; }
    input { width:100%; border:1px solid #e5e5ea; border-radius: 12px; padding: 12px; font-size:14px; outline:none; }
    input:focus { border-color:#0A84FF; }
    .btn { width:100%; border:1px solid #e5e5ea; background:#0A84FF; color:#fff; padding:12px 16px; border-radius:12px; font-weight:600; cursor:pointer; margin-top:14px; }
    .btn:disabled { opacity:.6; cursor:not-allowed; }
    .link { display:inline-block; margin-top:10px; font-size:13px; color:#0A84FF; text-decoration:none; }
    .msg { margin-top:12px; font-size:13px; color:#6e6e73; min-height: 18px; }
    .brand { display:flex; align-items:center; gap:10px; justify-content:center; margin-bottom: 10px; }
    .brand img { height:24px; width:24px; border-radius:999px; background:#0A3A8C; padding:6px; box-sizing:content-box; }
  </style>
</head>
<body>
  <div class="auth-wrap">
    <div class="card">
      <div class="brand">
        <img src="https://i.postimg.cc/L8w6XpRT/PSC-AVION.webp" alt="PSC" referrerpolicy="no-referrer" />
        <strong>PSC Cargas</strong>
      </div>
      <h1 class="title">ADMIN-PSC</h1>
      <p class="subtitle">Accede para usar SUBIR CORTE, MAL IDENTIFICADOS y SEARCH & ML</p>

      <label for="email">Correo</label>
      <input id="email" type="email" placeholder="tu@correo.com" autocomplete="username" />
      <label for="password">Contraseña</label>
      <input id="password" type="password" placeholder="••••••••" autocomplete="current-password" />

      <button class="btn" id="loginBtn">Iniciar sesión</button>
      <a class="link" href="reset.html">¿Olvidaste tu contraseña?</a>
      <div class="msg" id="msg"></div>
    </div>
  </div>

  <script>
    const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.__PSC_CONFIG__ || {};
    const supabase = window.supabase?.createClient?.(SUPABASE_URL, SUPABASE_ANON_KEY);

    const emailEl = document.getElementById('email');
    const passEl = document.getElementById('password');
    const btn = document.getElementById('loginBtn');
    const msg = document.getElementById('msg');

    async function doLogin() {
      msg.textContent = '';
      btn.disabled = true;
      try {
        if (!supabase) throw new Error('Supabase no inicializado. Completa config.js');
        const email = emailEl.value.trim();
        const password = passEl.value;
        if (!email || !password) throw new Error('Completa correo y contraseña');
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;
        // Bridge: guarda email para compatibilidad con tu lógica actual (sin tocarla)
        try { localStorage.setItem('psc_user_email', email); localStorage.setItem('email', email); } catch(e) {}
        // Redirige al portal
        location.href = 'landing.html';
      } catch (e) {
        msg.textContent = e.message || 'Error al iniciar sesión';
      } finally {
        btn.disabled = false;
      }
    }

    btn.addEventListener('click', doLogin);
    passEl.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') doLogin(); });

    // Si ya hay sesión, redirige al portal
    (async ()=>{
      try {
        if (!supabase) return;
        const { data } = await supabase.auth.getSession();
        if (data?.session) location.replace('landing.html');
      } catch(_) {}
    })();
  </script>
</body>
</html>
