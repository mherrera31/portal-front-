<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Wrapper con Volver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --border:#e5e7eb;
      --bg:#0b0b0b;
      --card:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{background:#fff}

    /* Contenedor pantalla completa */
    .viewport{
      position:fixed; inset:0;
      background: radial-gradient(1200px 800px at 10% -10%, rgba(255,197,61,.09), transparent 55%),
                  radial-gradient(900px 600px at 90% 10%, rgba(99,102,241,.12), transparent 50%),
                  linear-gradient(180deg, #fff 0%, #f7f7f9 100%);
    }
    iframe{
      position:absolute; inset:0;
      width:100%; height:100svh; border:0; background:#fff;
    }

    /* Botón Volver (flotante) */
    .psc-back-main{
      position:fixed; top:16px; left:16px; z-index:9999;
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:12px; text-decoration:none;
      font-weight:600; font-size:14px; border:1px solid var(--border);
      background:#ffffff; color:#111827;
      box-shadow:0 8px 24px rgba(0,0,0,.12);
      transition:transform .15s, box-shadow .15s, border-color .15s;
    }
    .psc-back-main:hover{ transform:translateY(-1px); box-shadow:0 12px 32px rgba(0,0,0,.18); border-color:#d1d5db }
    .psc-back-main:focus-visible{ outline:none; box-shadow:0 0 0 3px rgba(0,122,255,.35), 0 12px 32px rgba(0,0,0,.2) }

    /* Botón Abrir en pestaña nueva (opcional) */
    .open-new{
      position:fixed; top:16px; right:16px; z-index:9999;
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:12px; text-decoration:none;
      font-weight:600; font-size:14px; border:1px solid var(--border);
      background:#ffffff; color:#111827;
      box-shadow:0 8px 24px rgba(0,0,0,.12);
    }

    /* Fallback cuando el sitio no permite iframe */
    .fallback{
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      z-index:9998; width:min(92vw,560px);
      background:var(--card); border:1px solid var(--border); border-radius:16px;
      box-shadow:0 12px 36px rgba(0,0,0,.18); padding:16px; display:none;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      color:#111827;
    }
    .fallback h3{ margin:0 0 6px 0; font-size:18px }
    .fallback p{ margin:0 0 12px 0; color:#6b7280; font-size:14px }
    .fallback .row{ display:flex; gap:8px }
    .fallback a,.fallback button{
      flex:1; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:#111827; color:#fff; cursor:pointer; font-weight:600;
    }
    .fallback button.secondary{ background:#fff; color:#111827 }

    @media print{
      .psc-back-main,.open-new{ display:none !important }
      iframe{ height:auto }
    }
  </style>
</head>
<body>
  <!-- Botón Volver -->
  <a href="/" class="psc-back-main" aria-label="Volver al inicio"
     onclick="if(history.length>1){history.back();return false;}">
    <svg viewBox="0 0 24 24" width="18" height="18" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M15 18l-6-6 6-6"/>
    </svg>
    Volver
  </a>

  <!-- Abrir en pestaña nueva -->
  <a id="openNew" class="open-new" target="_blank" rel="noopener">Abrir en pestaña</a>

  <!-- Fondo + iframe -->
  <div class="viewport">
    <iframe id="page" title="Contenido embebido"></iframe>
  </div>

  <!-- Fallback si el sitio bloquea iframe -->
  <div id="fallback" class="fallback" role="alert">
    <h3>No se pudo mostrar la página aquí</h3>
    <p>El sitio bloquea la visualización dentro de un iframe. Puedes abrirlo en una pestaña nueva.</p>
    <div class="row">
      <button class="secondary" onclick="location.href='/'">Volver</button>
      <a id="fallbackOpen" target="_blank" rel="noopener">Abrir en pestaña</a>
    </div>
  </div>

  <script>
    // URL por defecto y soporte para ?url=
    const DEFAULT_URL = "https://www.soypsc.com/cotizador/";
    const params = new URLSearchParams(location.search);
    const targetUrl = params.get("url") ? decodeURIComponent(params.get("url")) : DEFAULT_URL;

    // Setear destinos
    const iframe = document.getElementById('page');
    const openNew = document.getElementById('openNew');
    const fb = document.getElementById('fallback');
    const fbOpen = document.getElementById('fallbackOpen');

    openNew.href = targetUrl;
    fbOpen.href = targetUrl;

    // Cargar y detectar bloqueo por X-Frame-Options/CSP
    let timedOut = false;
    const watchdog = setTimeout(() => {
      timedOut = true;
      fb.style.display = 'block';
    }, 3000); // si en 3s no carga, mostramos fallback

    iframe.addEventListener('load', () => {
      if (!timedOut) clearTimeout(watchdog);
      // Si carga, ocultamos fallback por si se mostró
      fb.style.display = 'none';
    });

    // Asignar src al final para iniciar carga
    iframe.src = targetUrl;
  </script>
</body>
</html>
